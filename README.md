# í˜„ëŒ€ì ì¸ ê°œë°œ ë¸”ë¡œê·¸ í”„ë¡œì íŠ¸

**ì‘í’ˆëª…**: í˜„ëŒ€ì ì¸ ê°œë°œ ë¸”ë¡œê·¸ í”Œë«í¼  
**ì‘í’ˆ ì£¼ì œ**: FastAPIì™€ í˜„ëŒ€ ì›¹ ê¸°ìˆ ì„ í™œìš©í•œ ë§ˆí¬ë‹¤ìš´ ì§€ì› ê°œë°œ ë¸”ë¡œê·¸ êµ¬ì¶•  

## ì£¼ì œ ì„ ì • ì´ìœ 
í˜„ëŒ€ì ì¸ ì›¹ ê°œë°œ ê¸°ìˆ ì„ í•™ìŠµí•˜ê³  ì‹¤ì œ ìš´ì˜ ê°€ëŠ¥í•œ ë¸”ë¡œê·¸ í”Œë«í¼ì„ êµ¬ì¶•í•˜ê¸° ìœ„í•´ ì„ ì •í–ˆìŠµë‹ˆë‹¤. FastAPIì˜ ê³ ì„±ëŠ¥ê³¼ Pythonì˜ í¸ì˜ì„±ì„ í™œìš©í•˜ì—¬ ë§ˆí¬ë‹¤ìš´ ê¸°ë°˜ì˜ ê°œë°œì ì¹œí™”ì ì¸ ë¸”ë¡œê·¸ë¥¼ ë§Œë“¤ê³ , AI ê¸°ìˆ ì„ ì ‘ëª©í•œ ìš”ì•½ ê¸°ëŠ¥ìœ¼ë¡œ ì‚¬ìš©ì ê²½í—˜ì„ í–¥ìƒì‹œí‚¤ê³ ì í–ˆìŠµë‹ˆë‹¤.

## ì‘í’ˆ ë§í¬
- **GitHub ë§í¬**: https://github.com/stephankim/fastapi-blog-project
- **ë°°í¬ ë§í¬**: http://localhost:8000 (ë¡œì»¬ ê°œë°œ í™˜ê²½)

## í”„ë¡œì íŠ¸ ì„¤ëª…

### ê°œë°œ ê¸°ê°„
2024ë…„ 12ì›” - í˜„ì¬ (ì§„í–‰ ì¤‘)

### íŒ€ êµ¬ì„±
- **ê°œì¸ í”„ë¡œì íŠ¸**: í’€ìŠ¤íƒ ê°œë°œì (1ì¸)
- **ì—­í• **: ë°±ì—”ë“œ ê°œë°œ, í”„ë¡ íŠ¸ì—”ë“œ UI/UX, ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„, DevOps

### ğŸ› ï¸ ê¸°ìˆ  ìŠ¤íƒ

#### **Backend**
- **FastAPI 0.104.1**: í˜„ëŒ€ì ì´ê³  ê³ ì„±ëŠ¥ Python ì›¹ í”„ë ˆì„ì›Œí¬
- **SQLAlchemy 2.0.23**: Python SQL ë„êµ¬ í‚¤íŠ¸ ë° ORM
- **PyMySQL 1.1.0**: Python MySQL í´ë¼ì´ì–¸íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬
- **Uvicorn**: ASGI ì„œë²„ (ê°œë°œ ë° í”„ë¡œë•ì…˜)
- **SQLAdmin 0.16.1**: FastAPIìš© ê´€ë¦¬ì ì¸í„°í˜ì´ìŠ¤

#### **Database**
- **MySQL 8.0**: ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ ì‹œìŠ¤í…œ
- **Alembic 1.12.1**: SQLAlchemy ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ë„êµ¬

#### **Frontend & Template**
- **Jinja2 3.1.2**: í…œí”Œë¦¿ ì—”ì§„
- **Bootstrap 5.1.3**: CSS í”„ë ˆì„ì›Œí¬
- **Font Awesome 6.0.0**: ì•„ì´ì½˜ ë¼ì´ë¸ŒëŸ¬ë¦¬
- **Highlight.js**: ì½”ë“œ êµ¬ë¬¸ ê°•ì¡°

#### **Markdown & Content**
- **Python-Markdown 3.5.1**: ë§ˆí¬ë‹¤ìš´ ì²˜ë¦¬
- **Pygments 2.17.2**: êµ¬ë¬¸ ê°•ì¡° ë¼ì´ë¸ŒëŸ¬ë¦¬

#### **AI & Integration**
- **OpenRouter API**: AI ê¸°ë°˜ ì½˜í…ì¸  ìš”ì•½ (DeepSeek Chat V3 ëª¨ë¸ ì‚¬ìš©)
- **OpenAI >=1.50.0**: OpenRouter API í˜¸í™˜ í´ë¼ì´ì–¸íŠ¸

#### **Security & Authentication**
- **Passlib[bcrypt] 1.7.4**: ë¹„ë°€ë²ˆí˜¸ í•´ì‹±
- **python-jose[cryptography] 3.3.0**: JWT í† í° ì²˜ë¦¬
- **cryptography 41.0.7**: ì•”í˜¸í™” ë¼ì´ë¸ŒëŸ¬ë¦¬

#### **DevOps & Deployment**
- **Docker**: ì»¨í…Œì´ë„ˆí™”
- **Docker Compose**: ë©€í‹° ì»¨í…Œì´ë„ˆ ì• í”Œë¦¬ì¼€ì´ì…˜ ê´€ë¦¬

### ğŸ“± ì‹¤í–‰ í™”ë©´

#### **í™ˆí˜ì´ì§€**
![í™ˆí˜ì´ì§€ ìŠ¤í¬ë¦°ìƒ·]
- ìµœì‹  ê°œë°œ í¬ìŠ¤íŠ¸ ëª©ë¡ í‘œì‹œ
- ì½ê¸° ì‹œê°„ í‘œì‹œ ë° ê¸°ìˆ  ìŠ¤íƒ ì •ë³´
- ë‹¤í¬ëª¨ë“œ/ë¼ì´íŠ¸ëª¨ë“œ í† ê¸€
- ë°˜ì‘í˜• ë””ìì¸ìœ¼ë¡œ ëª¨ë°”ì¼ ì§€ì›

**ì£¼ìš” ê¸°ëŠ¥:**
- í¬ìŠ¤íŠ¸ ëª©ë¡ ì¡°íšŒ (ìµœì‹  10ê°œ í¬ìŠ¤íŠ¸)
- ê²€ìƒ‰ ê¸°ëŠ¥ (í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ)
- ì†Œì…œ ë§í¬ (GitHub, LinkedIn)
- í…Œë§ˆ ì „í™˜ (ë‹¤í¬/ë¼ì´íŠ¸ ëª¨ë“œ)
- í¬ìŠ¤íŠ¸ë³„ ì½ê¸° ì‹œê°„ ìë™ ê³„ì‚° (ë¶„ë‹¹ 200ë‹¨ì–´ ê¸°ì¤€)

#### **í¬ìŠ¤íŠ¸ ìƒì„¸ í˜ì´ì§€**
![í¬ìŠ¤íŠ¸ ìƒì„¸ í˜ì´ì§€ ìŠ¤í¬ë¦°ìƒ·]
- ë§ˆí¬ë‹¤ìš´ ë Œë”ë§ëœ ì½˜í…ì¸ 
- ì½”ë“œ êµ¬ë¬¸ ê°•ì¡° ë° ë³µì‚¬ ê¸°ëŠ¥
- ì±•í„°ë³„ ë„¤ë¹„ê²Œì´ì…˜ ì‚¬ì´ë“œë°”
- AI ê¸°ë°˜ ìš”ì•½ ê¸°ëŠ¥

**ì£¼ìš” ê¸°ëŠ¥:**
- ë§ˆí¬ë‹¤ìš´ ì™„ì „ ì§€ì› (ì œëª©, ì½”ë“œë¸”ë¡, í‘œ, ë§í¬, ì¤„ë°”ê¿ˆ ë“±)
- ëª©ì°¨ ìë™ ìƒì„± ë° ìŠ¤ë¬´ìŠ¤ ìŠ¤í¬ë¡¤
- ì½”ë“œ ë¸”ë¡ êµ¬ë¬¸ ê°•ì¡° (Pygments ì‚¬ìš©)
- OpenRouter AI ìš”ì•½ (DeepSeek Chat V3 ëª¨ë¸)
- ì½ê¸° ì§„í–‰ë¥  í‘œì‹œ
- í—¤ë”©ì— ì•µì»¤ ë§í¬ ìë™ ìƒì„±

#### **í¬ìŠ¤íŠ¸ ì‘ì„±/ìˆ˜ì • í˜ì´ì§€**
![í¬ìŠ¤íŠ¸ ì‘ì„± í˜ì´ì§€ ìŠ¤í¬ë¦°ìƒ·]
- ì‹¤ì‹œê°„ ë§ˆí¬ë‹¤ìš´ ë¯¸ë¦¬ë³´ê¸°
- ë§ˆí¬ë‹¤ìš´ ë¬¸ë²• ë„ì›€ë§
- í¼ ìœ íš¨ì„± ê²€ì‚¬

**ì£¼ìš” ê¸°ëŠ¥:**
- ì‹¤ì‹œê°„ ë§ˆí¬ë‹¤ìš´ ë¯¸ë¦¬ë³´ê¸° API ì œê³µ
- ë§ˆí¬ë‹¤ìš´ ë¬¸ë²• ê°€ì´ë“œ
- í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ìœ íš¨ì„± ê²€ì‚¬
- ì‚¬ìš©ì ì¸ì¦ ê¸°ë°˜ ê¶Œí•œ ê´€ë¦¬
- ì„¸ì…˜ ê¸°ë°˜ ë¡œê·¸ì¸ ì‹œìŠ¤í…œ

#### **ê´€ë¦¬ì í˜ì´ì§€**
![ê´€ë¦¬ì í˜ì´ì§€ ìŠ¤í¬ë¦°ìƒ·]
- SQLAdminì„ í†µí•œ ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬
- ì‚¬ìš©ì ë° í¬ìŠ¤íŠ¸ CRUD ì‘ì—…
- ì›¹ ê¸°ë°˜ ê´€ë¦¬ ì¸í„°í˜ì´ìŠ¤

**ì£¼ìš” ê¸°ëŠ¥:**
- ì‚¬ìš©ì ê´€ë¦¬ (ìƒì„±, ìˆ˜ì •, ì‚­ì œ)
- í¬ìŠ¤íŠ¸ ê´€ë¦¬ (ì¼ê´„ í¸ì§‘, ì‚­ì œ)
- ë°ì´í„°ë² ì´ìŠ¤ ì§ì ‘ ì ‘ê·¼ ì¸í„°í˜ì´ìŠ¤
- ê´€ë¦¬ì ê¶Œí•œ ê¸°ë°˜ ì ‘ê·¼ ì œì–´

#### **ì†Œê°œ í˜ì´ì§€**
![ì†Œê°œ í˜ì´ì§€ ìŠ¤í¬ë¦°ìƒ·]
- ê¸°ìˆ  ìŠ¤íƒ ì •ë³´
- í”„ë¡œì íŠ¸ ì£¼ìš” ê¸°ëŠ¥ ì†Œê°œ
- ê°œë°œì ì •ë³´

### ğŸ“ í”„ë¡œì íŠ¸ í´ë” êµ¬ì¡°

```
project/
â”œâ”€â”€ ğŸ“„ main.py                    # FastAPI ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜
â”œâ”€â”€ ğŸ—„ï¸ database.py               # ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì„¤ì •
â”œâ”€â”€ ğŸ“Š models.py                 # SQLAlchemy ë°ì´í„° ëª¨ë¸
â”œâ”€â”€ ğŸ“‹ schemas.py                # Pydantic ìŠ¤í‚¤ë§ˆ ì •ì˜
â”œâ”€â”€ ğŸ”§ crud.py                   # CRUD ì‘ì—… í´ë˜ìŠ¤
â”œâ”€â”€ ğŸ› ï¸ utils.py                  # ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ (ë§ˆí¬ë‹¤ìš´, AI)
â”œâ”€â”€ ğŸ” auth.py                   # ì¸ì¦ ë° ê¶Œí•œ ê´€ë¦¬
â”œâ”€â”€ ğŸ‘‘ admin.py                  # SQLAdmin ê´€ë¦¬ì ì„¤ì •
â”œâ”€â”€ ğŸš€ init_db.py                # ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ ğŸ‘¤ create_admin.py           # ê´€ë¦¬ì ê³„ì • ìƒì„± ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ ğŸ“¦ requirements.txt          # Python ì˜ì¡´ì„±
â”œâ”€â”€ ğŸ³ Dockerfile                # Docker ì´ë¯¸ì§€ ì„¤ì •
â”œâ”€â”€ ğŸ™ docker-compose.yml        # Docker Compose ì„¤ì •
â”œâ”€â”€ ğŸ™ docker-compose.dev.yml    # ê°œë°œìš© Docker Compose ì„¤ì •
â”œâ”€â”€ âš™ï¸ env.example                # í™˜ê²½ ë³€ìˆ˜ ì˜ˆì‹œ
â”œâ”€â”€ ğŸƒ run.sh                    # Docker ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ ğŸ’» run_local.sh              # ë¡œì»¬ ê°œë°œ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ ğŸ“š README.md                 # í”„ë¡œì íŠ¸ ë¬¸ì„œ
â”œâ”€â”€ ğŸ¨ templates/                # Jinja2 í…œí”Œë¦¿
â”‚   â”œâ”€â”€ base.html               # ê¸°ë³¸ ë ˆì´ì•„ì›ƒ
â”‚   â”œâ”€â”€ index.html              # í™ˆí˜ì´ì§€
â”‚   â”œâ”€â”€ post.html               # í¬ìŠ¤íŠ¸ ìƒì„¸
â”‚   â”œâ”€â”€ create.html             # í¬ìŠ¤íŠ¸ ì‘ì„±
â”‚   â”œâ”€â”€ edit.html               # í¬ìŠ¤íŠ¸ ìˆ˜ì •
â”‚   â”œâ”€â”€ login.html              # ë¡œê·¸ì¸ í˜ì´ì§€
â”‚   â””â”€â”€ about.html              # ì†Œê°œ í˜ì´ì§€
â””â”€â”€ ğŸ­ static/                   # ì •ì  íŒŒì¼
    â”œâ”€â”€ css/
    â”‚   â””â”€â”€ style.css           # ì»¤ìŠ¤í…€ CSS (ë‹¤í¬ëª¨ë“œ í¬í•¨)
    â””â”€â”€ js/
        â””â”€â”€ script.js           # JavaScript ê¸°ëŠ¥ë“¤
```

## ğŸ’» ì†ŒìŠ¤ ì½”ë“œ

### ì „ì²´ ì½”ë“œ êµ¬ì¡°

#### 1. FastAPI ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ (main.py)
```python
from fastapi import FastAPI, Request, Depends, HTTPException, status
from fastapi.staticfiles import StaticFiles
from fastapi.templating import Jinja2Templates
from fastapi.responses import HTMLResponse, RedirectResponse, JSONResponse
from starlette.middleware.sessions import SessionMiddleware
from sqlalchemy.orm import Session
from typing import Optional, Dict, Any
import os
from dotenv import load_dotenv

from database import get_db, engine
from models import Base, User
from crud import post_crud, user_crud
from schemas import PostCreate, PostUpdate, UserCreate
from utils import markdown_to_html, extract_headings, summarize_with_openrouter, generate_reading_time
from auth import authenticate_user, require_auth, is_authenticated
from sqladmin import Admin
from admin import UserAdmin, PostAdmin

# ìƒìˆ˜ ì •ì˜
DEFAULT_SECRET_KEY = "your-secret-key-here"
SESSION_MAX_AGE = 3600
DEFAULT_POST_LIMIT = 10

# í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ
load_dotenv()

# FastAPI ì•± ìƒì„±
app = FastAPI(title="ê°œë°œ ë¸”ë¡œê·¸", description="FastAPIë¡œ ë§Œë“  ê°œë°œ ë¸”ë¡œê·¸")

# Admin í˜ì´ì§€ ì„¤ì •
admin = Admin(app, engine)
admin.add_view(UserAdmin)
admin.add_view(PostAdmin)

# ì„¸ì…˜ ë¯¸ë“¤ì›¨ì–´ ì¶”ê°€
app.add_middleware(
    SessionMiddleware,
    secret_key=os.getenv("SECRET_KEY", DEFAULT_SECRET_KEY),
    max_age=SESSION_MAX_AGE
)

# ì •ì  íŒŒì¼ê³¼ í…œí”Œë¦¿ ì„¤ì •
app.mount("/static", StaticFiles(directory="static"), name="static")
templates = Jinja2Templates(directory="templates")

@app.get("/", response_class=HTMLResponse)
async def home(request: Request, db: Session = Depends(get_db)):
    """í™ˆí˜ì´ì§€ - ìµœì‹  í¬ìŠ¤íŠ¸ ëª©ë¡"""
    posts = post_crud.get_posts(db, skip=0, limit=DEFAULT_POST_LIMIT)
    
    # ê° í¬ìŠ¤íŠ¸ì— ì½ê¸° ì‹œê°„ ì¶”ê°€
    for post in posts:
        post.reading_time = generate_reading_time(post.content)
    
    return templates.TemplateResponse("index.html", {
        "request": request,
        "posts": posts,
        "is_authenticated": is_authenticated(request)
    })

@app.get("/post/{post_id}", response_class=HTMLResponse)
async def read_post(post_id: int, request: Request, db: Session = Depends(get_db)):
    """ê°œë³„ í¬ìŠ¤íŠ¸ ì½ê¸°"""
    post = post_crud.get_post(db, post_id=post_id)
    if post is None:
        raise HTTPException(status_code=404, detail="í¬ìŠ¤íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤")
    
    # ë§ˆí¬ë‹¤ìš´ì„ HTMLë¡œ ë³€í™˜
    html_content, toc_html = markdown_to_html(post.content)
    headings = extract_headings(post.content)
    reading_time = generate_reading_time(post.content)
    
    return templates.TemplateResponse("post.html", {
        "request": request,
        "post": post,
        "html_content": html_content,
        "headings": headings,
        "reading_time": reading_time,
        "is_authenticated": is_authenticated(request)
    })

@app.post("/api/summarize/{post_id}")
async def summarize_post(post_id: int, db: Session = Depends(get_db)):
    """AI í¬ìŠ¤íŠ¸ ìš”ì•½"""
    post = post_crud.get_post(db, post_id=post_id)
    if post is None:
        raise HTTPException(status_code=404, detail="í¬ìŠ¤íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤")
    
    summary = await summarize_with_openrouter(post.content)
    return JSONResponse(content={"summary": summary})
```

#### 2. ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì • (database.py)
```python
from sqlalchemy import create_engine
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import sessionmaker
import os

# ë°ì´í„°ë² ì´ìŠ¤ URL ì„¤ì •
DATABASE_URL = os.getenv("DATABASE_URL", "mysql+pymysql://blog_user:blog_password@localhost:3306/blog_db")

# SQLAlchemy ì—”ì§„ ìƒì„±
engine = create_engine(
    DATABASE_URL,
    echo=True,  # SQL ì¿¼ë¦¬ ë¡œê¹… (ê°œë°œìš©)
    pool_pre_ping=True,  # ì—°ê²° ìƒíƒœ í™•ì¸
    pool_recycle=300,  # ì—°ê²° ì¬ì‚¬ìš© ì‹œê°„
)

# ì„¸ì…˜ íŒ©í† ë¦¬ ìƒì„±
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

# ë² ì´ìŠ¤ í´ë˜ìŠ¤ ìƒì„±
Base = declarative_base()

# ë°ì´í„°ë² ì´ìŠ¤ ì„¸ì…˜ ì˜ì¡´ì„±
def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()
```

#### 3. ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë¸ (models.py)
```python
from sqlalchemy import Column, Integer, String, Text, DateTime, ForeignKey, Boolean
from sqlalchemy.orm import relationship
from sqlalchemy.sql import func
from database import Base

class User(Base):
    __tablename__ = "users"

    id = Column(Integer, primary_key=True, index=True)
    username = Column(String(50), unique=True, index=True, nullable=False)
    email = Column(String(100), unique=True, index=True, nullable=False)
    hashed_password = Column(String(255), nullable=False)
    is_active = Column(Boolean, default=True)
    created_at = Column(DateTime(timezone=True), server_default=func.now())
    updated_at = Column(DateTime(timezone=True), onupdate=func.now())

    # ê´€ê³„ ì„¤ì •
    posts = relationship("Post", back_populates="author")

class Post(Base):
    __tablename__ = "posts"

    id = Column(Integer, primary_key=True, index=True)
    title = Column(String(200), nullable=False)
    content = Column(Text, nullable=False)
    author_id = Column(Integer, ForeignKey("users.id"), nullable=False)
    created_at = Column(DateTime(timezone=True), server_default=func.now())
    updated_at = Column(DateTime(timezone=True), onupdate=func.now())

    # ê´€ê³„ ì„¤ì •
    author = relationship("User", back_populates="posts")
```

#### 4. Pydantic ìŠ¤í‚¤ë§ˆ (schemas.py)
```python
from pydantic import BaseModel
from typing import Optional
from datetime import datetime

# User ìŠ¤í‚¤ë§ˆ
class UserBase(BaseModel):
    username: str
    email: str

class UserCreate(UserBase):
    password: str

class User(UserBase):
    id: int
    is_active: bool
    created_at: datetime
    updated_at: Optional[datetime] = None

    class Config:
        from_attributes = True

# Post ìŠ¤í‚¤ë§ˆ
class PostBase(BaseModel):
    title: str
    content: str

class PostCreate(PostBase):
    author_id: int

class PostUpdate(PostBase):
    pass

class Post(PostBase):
    id: int
    author_id: int
    created_at: datetime
    updated_at: Optional[datetime] = None
    author: Optional[User] = None

    class Config:
        from_attributes = True
```

#### 5. CRUD ì‘ì—… (crud.py)
```python
from sqlalchemy.orm import Session
from sqlalchemy import desc
from models import User, Post
from schemas import UserCreate, PostCreate, PostUpdate
from passlib.context import CryptContext

# ë¹„ë°€ë²ˆí˜¸ í•´ì‹±ì„ ìœ„í•œ ì»¨í…ìŠ¤íŠ¸
pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")

# User CRUD
class UserCRUD:
    def get_user(self, db: Session, user_id: int):
        return db.query(User).filter(User.id == user_id).first()

    def get_user_by_username(self, db: Session, username: str):
        return db.query(User).filter(User.username == username).first()

    def create_user(self, db: Session, user: UserCreate):
        hashed_password = pwd_context.hash(user.password)
        db_user = User(
            username=user.username,
            email=user.email,
            hashed_password=hashed_password
        )
        db.add(db_user)
        db.commit()
        db.refresh(db_user)
        return db_user

# Post CRUD
class PostCRUD:
    def get_post(self, db: Session, post_id: int):
        return db.query(Post).filter(Post.id == post_id).first()

    def get_posts(self, db: Session, skip: int = 0, limit: int = 100):
        return db.query(Post).order_by(desc(Post.created_at)).offset(skip).limit(limit).all()

    def create_post(self, db: Session, post: PostCreate):
        db_post = Post(**post.dict())
        db.add(db_post)
        db.commit()
        db.refresh(db_post)
        return db_post

# CRUD ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
user_crud = UserCRUD()
post_crud = PostCRUD()
```

#### 6. ì¸ì¦ ë° ê¶Œí•œ (auth.py)
```python
from fastapi import HTTPException, status, Depends, Request
from sqlalchemy.orm import Session
from passlib.context import CryptContext
from database import get_db
from crud import user_crud

# ë¹„ë°€ë²ˆí˜¸ í•´ì‹±
pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")

def verify_password(plain_password: str, hashed_password: str) -> bool:
    """ë¹„ë°€ë²ˆí˜¸ ê²€ì¦"""
    return pwd_context.verify(plain_password, hashed_password)

def authenticate_user(db: Session, username: str, password: str):
    """ì‚¬ìš©ì ì¸ì¦"""
    user = user_crud.get_user_by_username(db, username)
    if not user:
        return False
    if not verify_password(password, user.hashed_password):
        return False
    return user

def get_current_user(request: Request, db: Session = Depends(get_db)):
    """í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ê°€ì ¸ì˜¤ê¸°"""
    user_id = request.session.get("user_id")
    if not user_id:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤"
        )
    
    user = user_crud.get_user(db, user_id=user_id)
    if not user:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
        )
    return user

def require_auth(request: Request, db: Session = Depends(get_db)):
    """ì¸ì¦ì´ í•„ìš”í•œ ì—”ë“œí¬ì¸íŠ¸ìš© ì˜ì¡´ì„±"""
    return get_current_user(request, db)

def is_authenticated(request: Request) -> bool:
    """ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸"""
    return "user_id" in request.session
```

#### 7. ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ (utils.py)
```python
import markdown
import re
from markdown.extensions import codehilite, toc
import os
from typing import List, Dict
from openai import OpenAI

def markdown_to_html(text: str) -> str:
    """ë§ˆí¬ë‹¤ìš´ í…ìŠ¤íŠ¸ë¥¼ HTMLë¡œ ë³€í™˜"""
    md = markdown.Markdown(
        extensions=[
            'codehilite',
            'toc',
            'fenced_code',
            'tables',
            'nl2br'
        ],
        extension_configs={
            'codehilite': {
                'css_class': 'highlight',
                'use_pygments': True
            },
            'toc': {
                'anchorlink': True,
                'permalink': True,
                'baselevel': 1
            }
        }
    )
    html_content = md.convert(text)
    toc_html = md.toc
    
    # heading id ë¶€ì—¬
    headings = extract_headings(text)
    html_content = add_heading_ids(html_content, headings)
    return html_content, toc_html

def extract_headings(markdown_text: str) -> List[Dict[str, str]]:
    """ë§ˆí¬ë‹¤ìš´ì—ì„œ í—¤ë”©ì„ ì¶”ì¶œí•˜ì—¬ ëª©ì°¨ ìƒì„±"""
    headings = []
    lines = markdown_text.split('\n')
    
    for line in lines:
        line = line.strip()
        if line.startswith('#'):
            level = len(line) - len(line.lstrip('#'))
            title = line.lstrip('#').strip()
            if title:
                # ì•µì»¤ ë§í¬ ìƒì„±
                anchor = re.sub(r'[^\w\s-]', '', title.lower())
                anchor = re.sub(r'[-\s]+', '-', anchor).strip('-')
                
                headings.append({
                    'level': level,
                    'title': title,
                    'anchor': anchor
                })
    
    return headings

async def summarize_with_openrouter(content: str) -> str:
    """OpenRouter APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì½˜í…ì¸  ìš”ì•½"""
    try:
        if not os.getenv("API_KEY"):
            return "AI ìš”ì•½ì„ ì‚¬ìš©í•˜ë ¤ë©´ API_KEYë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”."
        
        # ì½˜í…ì¸  ê¸¸ì´ ì œí•œ (API í† í° ì œí•œ ê³ ë ¤)
        safe_content = content[:4000] if len(content) > 4000 else content
        
        prompt = f"""ë‹¤ìŒ ê°œë°œ ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ë¥¼ í•œêµ­ì–´ë¡œ ìš”ì•½í•´ì£¼ì„¸ìš”:

{safe_content}"""
        
        client = OpenAI(
            base_url="https://openrouter.ai/api/v1",
            api_key=os.getenv("API_KEY"),
        )
        
        completion = client.chat.completions.create(
            model="deepseek/deepseek-chat-v3-0324:free",
            messages=[{
                "role": "user",
                "content": prompt
            }]
        )
        
        summary_content = completion.choices[0].message.content
        return f"ğŸ“ AI ìš”ì•½:\n\n{summary_content}"
        
    except Exception as e:
        return f"AI ìš”ì•½ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {str(e)}"

def generate_reading_time(content: str) -> int:
    """ì˜ˆìƒ ì½ê¸° ì‹œê°„ ê³„ì‚° (ë¶„)"""
    words = len(content.split())
    # í‰ê·  ì½ê¸° ì†ë„: ë¶„ë‹¹ 200ë‹¨ì–´
    reading_time = max(1, round(words / 200))
    return reading_time
```

### í…œí”Œë¦¿ íŒŒì¼ë“¤

#### 8. ê¸°ë³¸ ë ˆì´ì•„ì›ƒ (templates/base.html)
```html
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Stephan's Dev{% endblock %}</title>
    
    <!-- Beer CSS (Material Design 3) -->
    <link href="https://cdn.jsdelivr.net/npm/beercss@3.11.29/dist/cdn/beer.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <!-- Highlight.js for code syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" rel="stylesheet" id="highlight-light">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" rel="stylesheet" id="highlight-dark" disabled>
    
    <!-- Custom styles -->
    <link href="{{ url_for('static', path='/css/style.css') }}" rel="stylesheet">
</head>
<body class="light">
    <!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
    <nav class="top">
        <div class="nav-left">
            <a href="/" style="text-decoration:none;color:inherit;"><h6>Stephan's Dev</h6></a>
            <a href="/">í™ˆ</a>
            <a href="/about">ì†Œê°œ</a>
        </div>
        <div class="nav-right">
            <button id="theme-toggle">
                <i class="material-icons" id="theme-icon">dark_mode</i>
            </button>
            {% if is_authenticated %}
                <span class="user-info">{{ request.session.username }}</span>
                <form method="POST" action="/logout" style="display: inline;">
                    <button type="submit" class="border">ë¡œê·¸ì•„ì›ƒ</button>
                </form>
            {% else %}
                <a href="/login" class="button-primary">ë¡œê·¸ì¸</a>
            {% endif %}
            <a href="/admin" class="button-primary">ì–´ë“œë¯¼</a>
        </div>
    </nav>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <main class="responsive">
        <div class="container">
            {% block content %}{% endblock %}
        </div>
    </main>

    <!-- Beer CSS JavaScript -->
    <script type="module" src="https://cdn.jsdelivr.net/npm/beercss@3.11.29/dist/cdn/beer.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script src="{{ url_for('static', path='/js/script.js') }}"></script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>
```

#### 9. í™ˆí˜ì´ì§€ (templates/index.html)
```html
{% extends "base.html" %}

{% block content %}
<div class="responsive main-content">
    <div class="content-area">
        <section class="main-posts">
            <h4><i>home</i>ìµœì‹  í¬ìŠ¤íŠ¸</h4>
            
            {% if posts %}
                {% for post in posts %}
                <article class="card">
                    <h5><a href="/post/{{ post.id }}">{{ post.title }}</a></h5>
                    <div class="meta-info">
                        <small>
                            <i>event</i> {{ post.created_at.strftime('%Yë…„ %mì›” %dì¼') }}
                            {% if post.author %}
                            <i>person</i> {{ post.author.username }}
                            {% endif %}
                            <i>schedule</i> ì•½ {{ post.reading_time }}ë¶„ ì½ê¸°
                        </small>
                    </div>
                    <p>{{ post.content[:200] }}{% if post.content|length > 200 %}...{% endif %}</p>
                    <div class="actions">
                        <a href="/post/{{ post.id }}">
                            <button><i>arrow_forward</i>ì½ì–´ë³´ê¸°</button>
                        </a>
                        {% if is_authenticated and post.author and post.author.username == request.session.username %}
                        <a href="/edit/{{ post.id }}">
                            <button class="border"><i>edit</i></button>
                        </a>
                        {% endif %}
                    </div>
                </article>
                {% endfor %}
            {% else %}
                <div class="center-align large-padding">
                    <h4>ì•„ì§ ê°œë°œ í¬ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤</h4>
                    <p>ì²« ë²ˆì§¸ ê°œë°œ í¬ìŠ¤íŠ¸ë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”!</p>
                    {% if is_authenticated %}
                    <a href="/create"><button class="large">ì²« í¬ìŠ¤íŠ¸ ì‘ì„±í•˜ê¸°</button></a>
                    {% endif %}
                </div>
            {% endif %}
        </section>
        
        <aside class="sidebar">
            <article class="card">
                <h6><i>code</i>ê°œë°œ ë¸”ë¡œê·¸ ì†Œê°œ</h6>
                <p>FastAPI, SQLAlchemy, Jinja2ë¡œ êµ¬ì¶•ëœ ê°œë°œ ë¸”ë¡œê·¸ì…ë‹ˆë‹¤.</p>
                <a href="/about"><button class="border">ë” ì•Œì•„ë³´ê¸°</button></a>
            </article>
            
            <article class="card">
                <h6><i>edit</i>ìƒˆ ê¸€ ì‘ì„±</h6>
                {% if is_authenticated %}
                <a href="/create"><button>ê¸€ì“°ê¸°</button></a>
                {% else %}
                <a href="/login"><button class="border">ë¡œê·¸ì¸</button></a>
                {% endif %}
            </article>
            
            <article class="card">
                <h6><i>build</i>ê¸°ìˆ  ìŠ¤íƒ</h6>
                <div class="tech-stack">
                    <span class="chip">FastAPI</span>
                    <span class="chip">MySQL</span>
                    <span class="chip">Docker</span>
                    <span class="chip">SQLAlchemy</span>
                </div>
            </article>
        </aside>
    </div>
</div>
{% endblock %}
```

#### 10. í¬ìŠ¤íŠ¸ ìƒì„¸ í˜ì´ì§€ (templates/post.html)
```html
{% extends "base.html" %}

{% block content %}
<div class="responsive main-content">
    <div class="content-area">
        <section class="main-posts">
            <article class="card">
                <h4>{{ post.title }}</h4>
                <div class="meta-info">
                    <small>
                        <i>event</i> {{ post.created_at.strftime('%Yë…„ %mì›” %dì¼ %H:%M') }}
                        {% if post.author %}
                        <i>person</i> {{ post.author.username }}
                        {% endif %}
                        <i>schedule</i> ì•½ {{ reading_time }}ë¶„ ì½ê¸°
                    </small>
                </div>
                
                <!-- AI ìš”ì•½ ë²„íŠ¼ -->
                <div class="actions" style="margin-bottom: 1rem;">
                    <button class="button-primary" id="ai-summary-btn">
                        <i>smart_toy</i>AI ìš”ì•½ ë³´ê¸°
                    </button>
                </div>
                
                <!-- AI ìš”ì•½ ì˜ì—­ -->
                <div id="ai-summary" class="card" style="display: none;">
                    <h6><i>smart_toy</i>AI ìš”ì•½</h6>
                    <div id="summary-content">ìš”ì•½ì„ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...</div>
                </div>
                
                <!-- ë§ˆí¬ë‹¤ìš´ ì½˜í…ì¸  -->
                <div class="markdown-content">
                    {{ html_content | safe }}
                </div>
                
                <div class="actions">
                    <a href="/"><button class="border">ëª©ë¡ìœ¼ë¡œ</button></a>
                    {% if is_authenticated and post.author and post.author.username == request.session.username %}
                    <a href="/edit/{{ post.id }}"><button class="border">ìˆ˜ì •</button></a>
                    {% endif %}
                </div>
            </article>
        </section>
        
        <!-- ëª©ì°¨ ì‚¬ì´ë“œë°” -->
        <aside class="sidebar post-sidebar">
            {% if headings %}
            <article class="card toc-card">
                <h6><i>list</i>ëª©ì°¨</h6>
                <nav class="toc">
                    {% for heading in headings %}
                    <div class="toc-item level-{{ heading.level }}">
                        <a href="#{{ heading.anchor }}" class="toc-link">{{ heading.title }}</a>
                    </div>
                    {% endfor %}
                </nav>
            </article>
            {% endif %}
        </aside>
    </div>
</div>

<script>
// AI ìš”ì•½ ê¸°ëŠ¥
document.getElementById('ai-summary-btn').addEventListener('click', async function() {
    const summaryDiv = document.getElementById('ai-summary');
    const summaryContent = document.getElementById('summary-content');
    
    summaryDiv.style.display = 'block';
    summaryContent.innerHTML = 'ìš”ì•½ì„ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...';
    
    try {
        const response = await fetch(`/api/summarize/{{ post.id }}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
        });
        const data = await response.json();
        summaryContent.innerHTML = data.summary;
    } catch (error) {
        summaryContent.innerHTML = 'ìš”ì•½ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
    }
});

// ëª©ì°¨ ìŠ¤ë¬´ìŠ¤ ìŠ¤í¬ë¡¤
document.querySelectorAll('.toc-link').forEach(link => {
    link.addEventListener('click', function(e) {
        e.preventDefault();
        const targetId = this.getAttribute('href').substring(1);
        const targetElement = document.getElementById(targetId);
        if (targetElement) {
            targetElement.scrollIntoView({ behavior: 'smooth' });
        }
    });
});
</script>
{% endblock %}
```

#### 11. í¬ìŠ¤íŠ¸ ì‘ì„± í˜ì´ì§€ (templates/create.html)
```html
{% extends "base.html" %}

{% block content %}
<div class="responsive main-content">
    <div class="content-area">
        <section class="main-posts">
            <div class="write-header">
                <div class="write-toolbar">
                    <button type="button" id="preview-toggle-btn">ë¯¸ë¦¬ë³´ê¸°</button>
                    <button type="submit" form="post-form" class="primary">ë°œí–‰</button>
                </div>
            </div>
            
            <div class="write-flex">
                <div class="write-form-area">
                    <form method="POST" action="/create" id="post-form">
                        <div class="field">
                            <input type="text" id="title" name="title" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                        </div>
                        
                        <!-- ë§ˆí¬ë‹¤ìš´ íˆ´ë°” -->
                        <div class="markdown-toolbar">
                            <button type="button" data-md="bold">B</button>
                            <button type="button" data-md="italic">I</button>
                            <button type="button" data-md="code">{}</button>
                            <button type="button" data-md="link">Link</button>
                            <button type="button" data-md="heading">H</button>
                        </div>
                        
                        <div class="field">
                            <textarea id="content" name="content" required rows="15" 
                                placeholder="ë‹¹ì‹ ì˜ ì´ì•¼ê¸°ë¥¼ ì ì–´ë³´ì„¸ìš”..."></textarea>
                        </div>
                    </form>
                </div>
                
                <!-- ë¯¸ë¦¬ë³´ê¸° ì˜ì—­ -->
                <div class="write-preview-area" id="write-preview-area">
                    <h6>ë¯¸ë¦¬ë³´ê¸°</h6>
                    <div id="preview-content">
                        <p>ë‚´ìš©ì„ ì…ë ¥í•˜ë©´ ë¯¸ë¦¬ë³´ê¸°ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>
        </section>
    </div>
</div>

<script>
// ë§ˆí¬ë‹¤ìš´ íˆ´ë°” ê¸°ëŠ¥
document.querySelector('.markdown-toolbar').addEventListener('click', function(e) {
    if(e.target.tagName === 'BUTTON') {
        const textarea = document.getElementById('content');
        const type = e.target.getAttribute('data-md');
        const [start, end] = [textarea.selectionStart, textarea.selectionEnd];
        let insert = '';
        
        switch(type) {
            case 'bold': insert = '**êµµê²Œ**'; break;
            case 'italic': insert = '*ê¸°ìš¸ì„*'; break;
            case 'code': insert = '`ì½”ë“œ`'; break;
            case 'link': insert = '[í…ìŠ¤íŠ¸](url)'; break;
            case 'heading': insert = '# ì œëª©'; break;
        }
        
        if(insert) {
            const value = textarea.value;
            textarea.value = value.slice(0, start) + insert + value.slice(end);
            textarea.focus();
        }
    }
});

// ì‹¤ì‹œê°„ ë§ˆí¬ë‹¤ìš´ ë¯¸ë¦¬ë³´ê¸° (ë‹¨ìˆœ ë²„ì „)
document.getElementById('content').addEventListener('input', function() {
    const content = this.value;
    const preview = document.getElementById('preview-content');
    
    let html = content;
    html = html.replace(/^# (.*$)/gim, '<h1>$1</h1>');
    html = html.replace(/^## (.*$)/gim, '<h2>$1</h2>');
    html = html.replace(/\*\*(.*)\*\*/gim, '<strong>$1</strong>');
    html = html.replace(/\*(.*)\*/gim, '<em>$1</em>');
    html = html.replace(/`([^`]+)`/gim, '<code>$1</code>');
    html = html.replace(/\n/gim, '<br>');
    
    preview.innerHTML = html || '<p>ë‚´ìš©ì„ ì…ë ¥í•˜ë©´ ë¯¸ë¦¬ë³´ê¸°ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>';
});
</script>
{% endblock %}