{% extends "base.html" %}

{% block title %}ìƒˆ ê¸€ ì‘ì„± - ê°œë°œ ë¸”ë¡œê·¸{% endblock %}

{% block content %}
<div class="responsive main-content">
    <div class="content-area">
        <section class="main-posts">
            <div class="write-header">
                <div class="write-toolbar">
                    <button type="button" class="toolbar-btn" id="save-draft-btn"><i>save</i>ì„ì‹œì €ì¥</button>
                    <button type="button" class="toolbar-btn" id="preview-toggle-btn"><i>visibility</i>ë¯¸ë¦¬ë³´ê¸°</button>
                    <button type="submit" form="post-form" class="toolbar-btn primary"><i>publish</i>ë°œí–‰</button>
                </div>
            </div>
            <div class="write-flex no-card">
                <div class="write-form-area plain-area">
                    <form method="POST" action="/create" id="post-form">
                        <div class="field">
                            <input type="text" id="title" name="title" class="write-title" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                        </div>
                        <div class="markdown-toolbar">
                            <button type="button" data-md="bold" title="êµµê²Œ"><b>B</b></button>
                            <button type="button" data-md="italic" title="ê¸°ìš¸ì„"><i class="material-icons">format_italic</i></button>
                            <button type="button" data-md="code" title="ì½”ë“œ">{;}</button>
                            <button type="button" data-md="link" title="ë§í¬">ğŸ”—</button>
                            <button type="button" data-md="list" title="ëª©ë¡">â€¢ List</button>
                            <button type="button" data-md="quote" title="ì¸ìš©">â</button>
                            <button type="button" data-md="heading" title="ì œëª©">H</button>
                        </div>
                        <div class="field">
                            <textarea id="content" name="content" required rows="15" placeholder="ë‹¹ì‹ ì˜ ì´ì•¼ê¸°ë¥¼ ì ì–´ë³´ì„¸ìš”..."></textarea>
                        </div>
                        <div class="field">
                            <button type="button" class="border" onclick="toggleMarkdownHelp()">
                                <i>help</i>
                                <span>ë§ˆí¬ë‹¤ìš´ ë„ì›€ë§</span>
                            </button>
                            <div id="markdown-help" class="card" style="display: none; margin-top: 16px;">
                                <h6>ë§ˆí¬ë‹¤ìš´ ë¬¸ë²•:</h6>
                                <p><code># ì œëª©</code> - í° ì œëª©</p>
                                <p><code>## ì†Œì œëª©</code> - ì‘ì€ ì œëª©</p>
                                <p><code>**êµµê²Œ**</code> - êµµì€ ê¸€ì”¨</p>
                                <p><code>*ê¸°ìš¸ì„*</code> - ê¸°ìš¸ì„ ê¸€ì”¨</p>
                                <p><code>`ì½”ë“œ`</code> - ì¸ë¼ì¸ ì½”ë“œ</p>
                                <p><code>```ì–¸ì–´<br>ì½”ë“œ ë¸”ë¡<br>```</code> - ì½”ë“œ ë¸”ë¡</p>
                                <p><code>- í•­ëª©</code> - ëª©ë¡</p>
                                <p><code>[í…ìŠ¤íŠ¸](URL)</code> - ë§í¬</p>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="write-preview-area plain-area" id="write-preview-area">
                    <div>
                        <h6><i>visibility</i>ë¯¸ë¦¬ë³´ê¸°</h6>
                        <div id="preview-content" style="min-height: 600px;">
                            <p class="grey-text">ë‚´ìš©ì„ ì…ë ¥í•˜ë©´ ë¯¸ë¦¬ë³´ê¸°ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
</div>
<script>
function toggleMarkdownHelp() {
    const helpDiv = document.getElementById('markdown-help');
    const mainContent = document.querySelector('.main-content');
    if (helpDiv.style.display === 'none') {
        helpDiv.style.display = 'block';
        mainContent.classList.add('markdown-help-open');
    } else {
        helpDiv.style.display = 'none';
        mainContent.classList.remove('markdown-help-open');
    }
}
// ë§ˆí¬ë‹¤ìš´ íˆ´ë°” ê¸°ëŠ¥
const mdToolbar = document.querySelector('.markdown-toolbar');
const textarea = document.getElementById('content');
if(mdToolbar && textarea) {
    mdToolbar.addEventListener('click', function(e) {
        if(e.target.tagName === 'BUTTON') {
            const type = e.target.getAttribute('data-md');
            let [start, end] = [textarea.selectionStart, textarea.selectionEnd];
            let value = textarea.value;
            let insert = '', offset = 0;
            switch(type) {
                case 'bold': insert = '**êµµê²Œ**'; offset = 2; break;
                case 'italic': insert = '*ê¸°ìš¸ì„*'; offset = 1; break;
                case 'code': insert = '``ì½”ë“œ``'; offset = 1; break;
                case 'link': insert = '[í…ìŠ¤íŠ¸](url)'; offset = 1; break;
                case 'list': insert = '- í•­ëª©'; offset = 2; break;
                case 'quote': insert = '> ì¸ìš©ë¬¸'; offset = 2; break;
                case 'heading': insert = '# ì œëª©'; offset = 2; break;
            }
            if(insert) {
                textarea.value = value.slice(0, start) + insert + value.slice(end);
                textarea.focus();
                textarea.setSelectionRange(start+offset, start+insert.length-offset);
            }
        }
    });
}
// ë¯¸ë¦¬ë³´ê¸° íƒ­ ì „í™˜
const previewToggleBtn = document.getElementById('preview-toggle-btn');
const writeFormArea = document.querySelector('.write-form-area');
const writePreviewArea = document.getElementById('write-preview-area');
let previewMode = false;
if(previewToggleBtn) {
    previewToggleBtn.addEventListener('click', function() {
        previewMode = !previewMode;
        if(previewMode) {
            writeFormArea.style.display = 'none';
            writePreviewArea.style.display = 'block';
            previewToggleBtn.classList.add('active');
        } else {
            writeFormArea.style.display = 'block';
            writePreviewArea.style.display = 'flex';
            previewToggleBtn.classList.remove('active');
        }
    });
}
// ì‹¤ì‹œê°„ ë§ˆí¬ë‹¤ìš´ ë¯¸ë¦¬ë³´ê¸°
let previewTimeout;
const previewDiv = document.getElementById('preview-content');
function updatePreview() {
    const content = textarea.value;
    if (!content.trim()) {
        previewDiv.innerHTML = '<p class="grey-text">ë‚´ìš©ì„ ì…ë ¥í•˜ë©´ ë¯¸ë¦¬ë³´ê¸°ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>';
        return;
    }
    let html = content;
    html = html.replace(/^### (.*$)/gim, '<h3>$1</h3>');
    html = html.replace(/^## (.*$)/gim, '<h2>$1</h2>');
    html = html.replace(/^# (.*$)/gim, '<h1>$1</h1>');
    html = html.replace(/\*\*(.*)\*\*/gim, '<strong>$1</strong>');
    html = html.replace(/\*(.*)\*/gim, '<em>$1</em>');
    html = html.replace(/`([^`]+)`/gim, '<code>$1</code>');
    html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/gim, '<a href="$2">$1</a>');
    html = html.replace(/^\- (.*$)/gim, '<li>$1</li>');
    html = html.replace(/(<li>.*<\/li>)/gims, '<ul>$1</ul>');
    html = html.replace(/\n/gim, '<br>');
    previewDiv.innerHTML = html;
}
if(textarea) {
    textarea.addEventListener('input', function() {
        clearTimeout(previewTimeout);
        previewTimeout = setTimeout(updatePreview, 300);
    });
    updatePreview();
}
</script>
{% endblock %} 